#!/bin/bash

# Check sudo
if [ "$(id -u)" != "0" ]; then
	echo "You need root privileges to run this script."
	exit 1
fi


echo -ne "\nStarting VulneLora installation...\n\n"
echo "[INFO]: VulneLora core will be located in /opt/vulnelora"
echo -ne "[INFO]: VulneLora service will be located in /usr/local/bin\n\n"


# Required services installation
apt update -y
services_file="requirements.txt"

if [ ! -f "$services_file" ]; then
	echo "[ERROR]: File $services_file not found. It should be in the same directory as this script."
	exit 1
fi

while IFS= read -r service; do
	apt install -y "$service"
done < "$services_file"


# Service alias
touch /usr/local/bin/vulnelora
chmod +x /usr/local/bin/vulnelora
echo '#!/bin/bash\npython3 /opt/vulnelora/vulnelora_main.py "@"' > /usr/local/bin/vulnelora


# Installation check
if [ -s "/usr/local/bin/vulnelora" ]; then
	echo "[SUCCESS]: VulneLora service created successfully!"

	if [ ! -x "$file_path" ]; then
		echo "[SUCCESS]: VulneLora service has executable permissions!"
	else
		echo "[ERROR]: VulneLora service does not have executable permissions, assign them manually please"
	fi

else
	if [ -e "$file_path" ]; then
		echo "File '$file_path' exists but is empty."
 else
        echo "File '$file_path' does not exist."
    fi
	echo "[ERROR]: VulneLora service not located in /usr/local/bin"
fi
